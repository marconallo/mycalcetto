{"ts":1343809536665,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"<?php\r\n\r\nif (!defined('INCLUDE_CHECK'))\r\n    die('You are not allowed to execute this file directly');\r\n\r\nrequire_once 'user_access/connect.php';\r\nrequire_once 'user_access/functions.php';\r\nrequire_once 'functions_campi.php';\r\nrequire_once 'functions_user.php';\r\n\r\nrequire_once 'script/log.php';\r\n$logDir = \"log\";\r\n$logFileName = \"debug\";\r\n$headerTitle = \"MyCalcetto\";\r\n$logMode = \"oneFile\"; //oneFile: each log instance goes to the same file ([logFileName].log) | oneFilePerLog: each log instance goes to a new file ([logFileName][logNumber].log\r\n$counterFile = \"debug.counter\";\r\n$logger = new Log($logDir, $logFileName, $headerTitle, $logMode, $counterFile);\r\n\r\nfunction accettaPartita($user, $id_partita) {\r\n\r\n    $numero_giocatori_query = \"SELECT NUM_GIOCATORI FROM PARTITA WHERE ID_PARTITA = $id_partita\";\r\n    $res_num_giocatori = mysql_query(numero_giocatori_query);\r\n    $riga_num_giocatori = mysql_fetch_array($res_num_giocatori);\r\n    \r\n    $numero_giocatori = $riga_num_giocatori['NUM_GIOCATORI'];\r\n\r\n    $conto2 = \"SELECT USER_ID FROM PARTECIPAZIONE WHERE USER_ID = '$user' AND ID_PARTITA = $id_partita AND PARTECIPA = 1\";\r\n    $res2 = mysql_query($conto2);\r\n    $riga2 = mysql_fetch_array($res2);\r\n    if ($riga2) { /* Gia' iscritto */\r\n        echo \"<div class='warning'>Sei gi&agrave; iscritto a questa partita!</div>\";\r\n        echo \"<p>Torna alla <a href='visualizzaPartite.php'>pagina precedente</a>.</p>\";\r\n    } else { /* Da iscrivere */\r\n        $conto = \"SELECT count(USER_ID) as NUMERO FROM PARTECIPAZIONE WHERE ID_PARTITA = $id_partita AND PARTECIPA = 1\";\r\n        $res = mysql_query($conto);\r\n        $riga = mysql_fetch_array($res);\r\n        if ($riga) {\r\n            if ($riga['NUMERO'] < $numero_giocatori) { /* C'e' ancora posto */\r\n\r\n                $query = \"UPDATE PARTECIPAZIONE SET PARTECIPA = 1 WHERE USER_ID = '$user' AND ID_PARTITA = $id_partita\";\r\n                $result = mysql_query($query);\r\n\r\n                echo \"<div class='success'>La tua iscrizione alla partita &egrave; stata registrata!<br />Ti verr&agrave; inviata un'e-mail quando la partita sar&agrave; confermata.</div>\";\r\n                echo \"</br><p>Torna alla <a href='visualizzaPartite.php'>pagina precedente</a>.</p>\";\r\n\r\n                $conto = \"SELECT count(USER_ID) as NUMERO FROM PARTECIPAZIONE WHERE ID_PARTITA = $id_partita AND PARTECIPA = 1\";\r\n                $res = mysql_query($conto);\r\n\t\t$riga = mysql_fetch_array($res);\r\n                if ($riga) {\r\n                    if ($riga['NUMERO'] == $numero_giocatori) { /* Iscritti tutti! */\r\n                        chiudiPartita($id_partita);\r\n                    }\r\n                } else { /* Errore query */\r\n                    echo \"<div class='error'>Si &egrave; verificato un errore!</div>\";\r\n                    echo \"</br><p>Torna alla <a href='visualizzaPartite.php'>pagina precedente</a>.</p>\";\r\n                }\r\n            } else { /* Non c'e' piu' posto */\r\n                echo \"<div class='warning'>Mi dispiace, non ci sono pi&ugrave; posti disponibili!</div>\";\r\n                echo \"</br><p>Torna alla <a href='visualizzaPartite.php'>pagina precedente</a>.</p>\";\r\n            }\r\n        } else { /* Errore query */\r\n            echo \"<div class='error'>Si &egrave; verificato un errore!</div>\";\r\n            echo \"</br><p>Torna alla <a href='visualizzaPartite.php'>pagina precedente</a>.</p>\";\r\n        }\r\n    }\r\n}\r\n\r\nfunction chiudiPartita($idPartita) {\r\n\r\n    global $logger;\r\n    $rs1 = getPartitaById($idPartita);\r\n    $row1 = mysql_fetch_array($rs1);\r\n    $data = $row1[\"DATA\"];\r\n    $ora = $row1[\"ORA\"];\r\n\r\n    $rs2 = getCampoById($row1[\"ID_CAMPO\"]);\r\n    $row2 = mysql_fetch_array($rs2);\r\n    $nomeCampo = $row2[\"NOME\"];\r\n    $indCampo = $row2[\"INDIRIZZO\"];\r\n\r\n    $rs = getPartecipanti($idPartita);\r\n    while ($row = mysql_fetch_array($rs)) {\r\n        $nome = $row[\"NAME\"];\r\n        $email = $row[\"EMAIL\"];\r\n\r\n        $message = '\r\n\t\t\t\t<html>\r\n\t\t\t\t<head>\r\n\t\t\t\t  <title>Partita Confermata</title>\r\n\t\t\t\t</head>\r\n\t\t\t\t<body style=\"font-family: verdana, sans-serif; color: #272727;\">\r\n\t\t\t\t  <p>Ciao ' . $nome . ',<br />la partita &egrave; stata <strong>confermata</strong>!</p>\r\n\t\t\t\t  <p>\r\n\t\t\t\t  Data: <strong>' . $data . '</strong><br />\r\n\t\t\t\t  Ora: <strong>' . $ora . '</strong><br />\r\n\t\t\t\t  Dove: ' . $nomeCampo . ' - ' . $indCampo . '<br />\r\n\t\t\t\t  </p>\r\n\t\t\t\t  <p>Trovi i dettagli sul <a href=\"http://mycalcetto.altervista.org/visualizzaPartite.php\" target=\"_blank\">sito</a>.</p>\r\n\t\t\t\t  <p>Saluti,<br/>il team di MyCalcetto</p>\r\n\t\t\t\t</body>\r\n\t\t\t\t</html>';\r\n\r\n        if (send_mail('MyCalcetto <mycalcetto@altervista.org>', $email, 'Partita Confermata', $message, 'mycalcetto@altervista.org')) {\r\n            $logger->logThis($logger->get_formatted_date() . '[INFO] Conferma inviata a: ' . $email);\r\n            sleep(1);\r\n        } else {\r\n            $logger->logThis($logger->get_formatted_date() . '[ERROR] Impossibile inviare conferma a: ' . $email);\r\n        }\r\n    }\r\n    $query_elimina = \"DELETE FROM PARTECIPAZIONE WHERE ID_PARTITA = $idPartita AND PARTECIPA <> 1;\";\r\n    if (mysql_query($query_elimina)) {\r\n        $logger->logThis($logger->get_formatted_date() . '[INFO] Eliminati i non-partecipanti');\r\n    } else {\r\n        $logger->logThis($logger->get_formatted_date() . '[ERROR] Impossibile eliminare i non-partecipanti');\r\n    }\r\n    $query_close = \"UPDATE PARTITA SET STATO = 'C' WHERE ID = $idPartita;\";\r\n    if (mysql_query($query_close)) {\r\n        $logger->logThis($logger->get_formatted_date() . '[INFO] Partita chiusa correttamente!');\r\n    } else {\r\n        $logger->logThis($logger->get_formatted_date() . '[ERROR] Impossibile chiudere la partita');\r\n    }\r\n}\r\n\r\nfunction rifiutaPartita($user, $id_partita) {\r\n\r\n    $query = \"UPDATE PARTECIPAZIONE SET PARTECIPA = -1 WHERE USER_ID = '$user' AND ID_PARTITA = $id_partita\";\r\n    $result = mysql_query($query);\r\n    echo \"<div class='info'>Partita rifiutata.</div>\";\r\n    echo \"</br><p>Torna alla <a href='visualizzaPartite.php'>pagina precedente</a>.</p>\";\r\n}\r\n\r\nfunction cancellaPartita($user, $id_partita) {\r\n\r\n    global $logger;\r\n    $query_partecipanti = \"SELECT u.ID AS USER_ID, u.EMAIL AS EMAIL, u.NAME AS NOME, x.ID_ORGANIZZATORE, u2.NAME AS NOME_ORG, u2.SURNAME AS COGNOME_ORG, u2.EMAIL AS EMAIL_ORG, DATE_FORMAT(x.ORA_INIZIO,'%H.%i') AS ORA, DATE_FORMAT(x.ORA_INIZIO,'%d-%m-%Y') AS DATA, c.NOME AS NOME_CAMPO FROM PARTECIPAZIONE p, TZ_MEMBERS u, TZ_MEMBERS u2, CAMPO c, PARTITA x WHERE p.ID_PARTITA = $id_partita AND x.ID = p.ID_PARTITA AND x.ID_CAMPO = c.ID AND u.ID = p.USER_ID AND x.ID_ORGANIZZATORE = u2.ID AND p.PARTECIPA = 1 AND u.ID <> '$user';\";\r\n    $result_partecipanti = mysql_query($query_partecipanti);\r\n\r\n    $c = 0;\r\n    while ($row = mysql_fetch_array($result_partecipanti)) {\r\n        $data = $row[\"DATA\"];\r\n        $ora = $row[\"ORA\"];\r\n        $nome_campo = $row[\"NOME_CAMPO\"];\r\n        $nome = $row[\"NOME\"];\r\n        $mail = $row[\"EMAIL\"];\r\n        $email_org = $row[\"EMAIL_ORG\"];\r\n        $nome_org = $row[\"NOME_ORG\"] . \" \" . $row[\"COGNOME_ORG\"];\r\n\r\n        $message = '\r\n\t\t\t\t<html>\r\n\t\t\t\t<head>\r\n\t\t\t\t  <title>Partita Annullata</title>\r\n\t\t\t\t</head>\r\n\t\t\t\t<body style=\"font-family: verdana, sans-serif; color: #272727;\">\r\n\t\t\t\t  <p>Ciao ' . $nome . ',<br />la seguente partita &egrave; stata <span style=\"font-weight: bold; color: red;\">ANNULLATA</span> dall\\'organizzatore.</p>\r\n\t\t\t\t  <p>\r\n\t\t\t\t  Data: <strong>' . $data . '</strong><br />\r\n\t\t\t\t  Ora: <strong>' . $ora . '</strong><br />\r\n\t\t\t\t  Dove: ' . $nome_campo . '<br />\r\n\t\t\t\t  Organizzatore: ' . $nome_org . '\r\n\t\t\t\t  </p>\r\n\t\t\t\t  <p>Saluti,<br/>lo staff di MyCalcetto</p>\r\n\t\t\t\t</body>\r\n\t\t\t\t</html>';\r\n        if (send_mail('MyCalcetto <mycalcetto@altervista.org>', $mail, 'MyCalcetto - Partita ANNULLATA', $message)) {\r\n            $c = $c + 1;\r\n            $logger->logThis($logger->get_formatted_date() . '[INFO] Cancellazione inviata a: ' . $mail);\r\n            sleep(1);\r\n        } else {\r\n            $logger->logThis($logger->get_formatted_date() . '[ERROR] Impossibile inviare cancellazione a: ' . $mail);\r\n        }\r\n    }\r\n\r\n    $query = \"DELETE FROM PARTITA WHERE ID = $id_partita\";\r\n    $result = mysql_query($query);\r\n\r\n    $query2 = \"DELETE FROM PARTECIPAZIONE WHERE ID_PARTITA = $id_partita\";\r\n    $result2 = mysql_query($query2);\r\n\r\n    echo \"<div class='info'>La partita &egrave; stata annullata. &Egrave; stata inviata una e-mail a chi era iscritto ($c persone).<br /></div>\";\r\n    echo \"</br><p>Torna alla <a href='visualizzaPartite.php'>pagina precedente</a>.</p>\";\r\n}\r\n\r\nfunction contaPartecipanti($id_partita) {\r\n    $query0 = \"SELECT COUNT(USER_ID) AS NUMERO FROM PARTECIPAZIONE WHERE ID_PARTITA = '$id_partita' AND PARTECIPA = 1\";\r\n    $result0 = mysql_query($query0);\r\n    $row0 = mysql_fetch_array($result0);\r\n    if ($row0) {\r\n        return $row0[\"NUMERO\"];\r\n    } else {\r\n        return -1;\r\n    }\r\n}\r\n\r\nfunction getPartecipanti($id_partita) {\r\n    $query = \"SELECT u.ID, u.NAME, u.SURNAME, u.EMAIL FROM PARTECIPAZIONE p, TZ_MEMBERS u WHERE ID_PARTITA = $id_partita AND u.ID = p.USER_ID AND p.PARTECIPA = 1 ORDER BY u.NAME;\";\r\n    return mysql_query($query);\r\n}\r\n\r\nfunction getRifiutanti($id_partita) {\r\n    $query = \"SELECT u.NAME, u.SURNAME FROM PARTECIPAZIONE p, TZ_MEMBERS u WHERE ID_PARTITA = $id_partita AND u.ID = p.USER_ID AND p.PARTECIPA = -1 AND p.USER_ID NOT LIKE 'guest%';\";\r\n    return mysql_query($query);\r\n}\r\n\r\nfunction getIndecisi($id_partita) {\r\n    $query = \"SELECT u.NAME, u.SURNAME FROM PARTECIPAZIONE p, TZ_MEMBERS u WHERE ID_PARTITA = $id_partita AND u.ID = p.USER_ID AND p.PARTECIPA = 0 AND p.USER_ID NOT LIKE 'guest%';\";\r\n    return mysql_query($query);\r\n}\r\n\r\nfunction visualizzaPartecipanti($id_partita, $isAdmin) {\r\n\r\n    //$query=\"SELECT u.NAME, u.SURNAME FROM PARTECIPAZIONE p, TZ_MEMBERS u WHERE ID_PARTITA = $id_partita AND u.ID = p.USER_ID AND p.PARTECIPA = 1 ORDER BY u.NAME\";\r\n    $result = getPartecipanti($id_partita);\r\n    $row = mysql_fetch_array($result);\r\n    if ($row) {\r\n        echo \"<ol>\";\r\n        do {\r\n            $partecipante = $row[\"NAME\"] . \" \" . $row[\"SURNAME\"];\r\n            $userId = $row[\"ID\"];\r\n            if ($isAdmin == 1) {\r\n                echo \"<li style='line-height:25px;'>$partecipante <a href='#' onclick='cancellaUserPartita($userId,$id_partita)'><img style='vertical-align:text-bottom;' src='img/Remove_16x16.png' alt='Cancella partecipante' title='Cancella partecipante' /></a></li>\";\r\n            } else {\r\n                echo \"<li>$partecipante</li>\";\r\n            }\r\n        } while ($row = mysql_fetch_array($result));\r\n        echo \"</ol>\";\r\n    } else {\r\n        echo \"<div class='info'>Non ci sono ancora partecipanti!</div>\";\r\n    }\r\n}\r\n\r\nfunction visualizzaPartecipantiXML() {\r\n\r\n    $query = \"SELECT u.NAME, u.SURNAME FROM PARTECIPAZIONE p, TZ_MEMBERS u WHERE p.USER_ID = u.ID  AND p.PARTECIPA = 1 AND ID_PARTITA IN  (SELECT MAX(ID) FROM PARTITA WHERE STATO != 'C' AND ORA_INIZIO > CURRENT_TIMESTAMP);\";\r\n    $result = mysql_query($query);\r\n    $row = mysql_fetch_array($result);\r\n    header('Content-Type: text/xml');\r\n    echo '<?xml version=\"1.0\" encoding=\"utf-8\" ?>\r\n        <rsp stat=\"ok\">';\r\n\r\n    if ($row) {\r\n        echo '<partecipanti>';\r\n        do {\r\n            echo '<partecipante name=\"';\r\n            $partecipante = $row[\"NAME\"] . \" \" . $row[\"SURNAME\"];\r\n            echo $partecipante;\r\n            echo '\"/>';\r\n        } while ($row = mysql_fetch_array($result));\r\n        echo '</partecipanti></rsp>';\r\n    }\r\n}\r\n\r\nfunction visualizzaRifiutanti($id_partita) {\r\n\r\n    //$query1=\"SELECT u.NAME, u.SURNAME FROM PARTECIPAZIONE p, TZ_MEMBERS u WHERE ID_PARTITA = $id_partita AND u.ID = p.USER_ID AND p.PARTECIPA = -1 AND p.USER_ID NOT LIKE 'guest%'\";\r\n    $result1 = getRifiutanti($id_partita);\r\n    $row1 = mysql_fetch_array($result1);\r\n    if ($row1) {\r\n        echo \"<ol>\";\r\n        do {\r\n            $partecipante = $row1[\"NAME\"] . \" \" . $row1[\"SURNAME\"];\r\n            echo \"<li>$partecipante</li>\";\r\n        } while ($row1 = mysql_fetch_array($result1));\r\n        echo \"</ol>\";\r\n    } else {\r\n        echo \"<div class='info'>Non ci sono ancora rifiutanti!</div>\";\r\n    }\r\n}\r\n\r\nfunction visualizzaIndecisi($id_partita) {\r\n\r\n    //$query2=\"SELECT u.NAME, u.SURNAME FROM PARTECIPAZIONE p, TZ_MEMBERS u WHERE ID_PARTITA = $id_partita AND u.ID = p.USER_ID AND p.PARTECIPA = 0 AND p.USER_ID NOT LIKE 'guest%'\";\r\n    $result2 = getIndecisi($id_partita);\r\n    $row2 = mysql_fetch_array($result2);\r\n    if ($row2) {\r\n        echo \"<ol>\";\r\n        do {\r\n            $partecipante = $row2[\"NAME\"] . \" \" . $row2[\"SURNAME\"];\r\n            echo \"<li>$partecipante</li>\";\r\n        } while ($row2 = mysql_fetch_array($result2));\r\n        echo \"</ol>\";\r\n    }\r\n}\r\n\r\nfunction visualizzaPartecipantiPagelle($id_partita, $userId) {\r\n    $result = getPartecipanti($id_partita);\r\n    $row = mysql_fetch_array($result);\r\n    if ($row) {\r\n        echo \"<br />\";\r\n        echo \"<form id='voti_$id_partita' method='post' action='partite.php'>\r\n\t\t \t\t<input type='hidden' name='id_partita' value='$id_partita' />\r\n\t\t \t\t<input type='hidden' name='action' value='inviaVoti' />\";\r\n        echo \"<table class='table2'>\";\r\n        echo \"<thead><tr>\";\r\n        echo \"<th scope='col'>Nome</th>\";\r\n        echo \"<th scope='col'>Voto</th>\";\r\n        echo \"<tbody>\";\r\n        do {\r\n            $partecipante = $row[\"NAME\"] . \" \" . $row[\"SURNAME\"];\r\n            $partecipanteId = $row[\"ID\"];\r\n            if ($partecipanteId != $userId) {\r\n                echo \"<tr>\";\r\n                echo \"<td>$partecipante</td>\";\r\n                echo \"<td><select id='voto_$partecipanteId' name='voto_$partecipanteId'>\";\r\n                echo \"<option value=''>s.v.</option>\";\r\n                echo \"<option value='3.0'>3</option>\";\r\n                echo \"<option value='4.0'>4</option>\";\r\n                echo \"<option value='5.0'>5</option>\";\r\n                echo \"<option value='6.0' selected='selected'>6</option>\";\r\n                echo \"<option value='7.0'>7</option>\";\r\n                echo \"<option value='8.0'>8</option>\";\r\n                echo \"<option value='9.0'>9</option>\";\r\n                echo \"<option value='10.0'>10</option></select></td>\";\r\n                echo \"</tr>\";\r\n                ;\r\n            }\r\n        } while ($row = mysql_fetch_array($result));\r\n        echo \"</tbody>\";\r\n        echo \"</table>\";\r\n        echo '<p></p>';\r\n        echo '<p><a onclick=\"inviaVoti(' . $id_partita . ');\" class=\"awesome medium blue\">Invia</a></p>';\r\n        echo \"</form>\";\r\n    } else {\r\n        echo \"<div class='info'>Non ci sono partecipanti!</div>\";\r\n    }\r\n}\r\n\r\nfunction printTeam($squadraA, $squadraB) {\r\n    echo(\"<b>Squadra A - Maglia Chiara:</b><br><br><ol>\");\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        list($a, $n, $c, $b) = split(\";\", $squadraA[$i]);\r\n        if (\"\" == $n) {\r\n            echo(\"<li>Ospite<br>\");\r\n        } else {\r\n            echo(\"<li> \" . $n . \" \" . $c . \" <br>\");\r\n        }\r\n    }\r\n    echo(\"</ol><br>\");\r\n    echo(\"<b>Squadra B - Maglia Scura:</b><br><br><ol>\");\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        list($a, $n, $c, $b) = split(\";\", $squadraB[$i]);\r\n        if (\"\" == $n) {\r\n            echo(\"<li>Ospite<br>\");\r\n        } else {\r\n            echo(\"<li> \" . $n . \" \" . $c . \" <br>\");\r\n        }\r\n    }\r\n    echo \"</ol>\";\r\n}\r\n\r\nfunction creaSquadre($id_partita) {\r\n\r\n    //Query che estrae gli id dei partecipanti\r\n    $query = \"SELECT USER_ID FROM PARTECIPAZIONE WHERE ID_PARTITA = $id_partita AND PARTECIPA = 1\";\r\n    $rs = mysql_query($query);\r\n    //mettere a posto il numrow\r\n    //$numRow = mysql_num_rows($rs);\r\n    for ($i = 0; $i <= 9; $i++) {\r\n        if ($row = mysql_fetch_array($rs)) {\r\n            $idUser[$i] = $row[\"USER_ID\"];\r\n        }\r\n    }\r\n\r\n\r\n\r\n    for ($i = 0; $i <= 9; $i++) {\r\n        //Query che calcola la media voto per tutti i giocatori -- aggiungi tu nella where la condizione USER_ID = quello che hai tirato fuori prima, in modo che lo faccia per un utente solo\r\n        $query = \"SELECT U.NAME AS NOME, U.SURNAME AS COGNOME, SUM(SOMMAVOTI)/SUM(NUMVOTANTI) AS MEDIA_VOTI, COUNT(P.PARTECIPA) AS NUM_PARTITE FROM TZ_MEMBERS U, PARTECIPAZIONE P WHERE U.ID = P.USER_ID AND U.ID = '$idUser[$i]' AND P.PARTECIPA = 1 AND P.SOMMAVOTI > 0 GROUP BY U.NAME, U.SURNAME ORDER BY MEDIA_VOTI DESC\";\r\n        $rs = mysql_query($query);\r\n        if ($row = mysql_fetch_array($rs)) {\r\n            $voto_ = $row[\"MEDIA_VOTI\"];\r\n            $cognome_ = $row[\"COGNOME\"];\r\n            $nome_ = $row[\"NOME\"];\r\n            $numPartite_ = $row[\"NUM_PARTITE\"];\r\n            $totale[$i] = $voto_ . \";\" . $nome_ . \";\" . $cognome_ . \";\" . $numPartite_;\r\n        }\r\n    }\r\n\r\n    //ordina array dal pi� piccolo al pi� grande\r\n    sort($totale);\r\n\r\n\r\n    /*     * *******Metodo di creazione squadra, NUMERO 1************ */\r\n    $squadraA1 = array($totale[0], $totale[2], $totale[4], $totale[6], $totale[8]);\r\n    $squadraB1 = array($totale[1], $totale[3], $totale[5], $totale[7], $totale[9]);\r\n    //calcolo per squadra A1\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        list($voto[$i], $nome[$i], $cognome[$i], $numPartite[$i]) = split(\";\", $squadraA1[$i]);\r\n    }\r\n    $totPartite = 0;\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        $totPartite = $totPartite + $numPartite[$i];\r\n    }\r\n    $valoreSquadraA1 = 0;\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        $valoreSquadraA1 = $valoreSquadraA1 + ($voto[$i] * ($numPartite[$i] / $totPartite));\r\n    }\r\n\r\n    //calcolo per squadra B1\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        list($voto[$i], $nome[$i], $cognome[$i], $numPartite[$i]) = split(\";\", $squadraB1[$i]);\r\n    }\r\n    $totPartite = 0;\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        $totPartite = $totPartite + $numPartite[$i];\r\n    }\r\n    $valoreSquadraB1 = 0;\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        $valoreSquadraB1 = $valoreSquadraB1 + ($voto[$i] * ($numPartite[$i] / $totPartite));\r\n    }\r\n\r\n    $metodo1 = $valoreSquadraA1 - $valoreSquadraB1;\r\n\r\n\r\n\r\n    /*     * *******Metodo di creazione squadra, NUMERO 2************ */\r\n    $squadraA2 = array($totale[0], $totale[2], $totale[4], $totale[7], $totale[9]);\r\n    $squadraB2 = array($totale[1], $totale[3], $totale[5], $totale[6], $totale[8]);\r\n    //calcolo per squadra A2\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        list($voto[$i], $nome[$i], $cognome[$i], $numPartite[$i]) = split(\";\", $squadraA2[$i]);\r\n    }\r\n    $totPartite = 0;\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        $totPartite = $totPartite + $numPartite[$i];\r\n    }\r\n    $valoreSquadraA2 = 0;\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        $valoreSquadraA2 = $valoreSquadraA2 + ($voto[$i] * ($numPartite[$i] / $totPartite));\r\n    }\r\n\r\n    //calcolo per squadra B2\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        list($voto[$i], $nome[$i], $cognome[$i], $numPartite[$i]) = split(\";\", $squadraB2[$i], 4);\r\n    }\r\n    $totPartite = 0;\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        $totPartite = $totPartite + $numPartite[$i];\r\n    }\r\n    $valoreSquadraB2 = 0;\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        $valoreSquadraB2 = $valoreSquadraB2 + ($voto[$i] * ($numPartite[$i] / $totPartite));\r\n    }\r\n\r\n    $metodo2 = $valoreSquadraA2 - $valoreSquadraB2;\r\n\r\n\r\n    /*     * *******Metodo di creazione squadra, NUMERO 3************ */\r\n    $squadraA3 = array($totale[0], $totale[2], $totale[5], $totale[7], $totale[9]);\r\n    $squadraB3 = array($totale[1], $totale[3], $totale[4], $totale[6], $totale[8]);\r\n    //calcolo per squadra A3\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        list($voto[$i], $nome[$i], $cognome[$i], $numPartite[$i]) = split(\";\", $squadraA3[$i]);\r\n    }\r\n    $totPartite = 0;\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        $totPartite = $totPartite + $numPartite[$i];\r\n    }\r\n    $valoreSquadraA2 = 0;\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        $valoreSquadraA3 = $valoreSquadraA3 + ($voto[$i] * ($numPartite[$i] / $totPartite));\r\n    }\r\n\r\n    //calcolo per squadra B3\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        list($voto[$i], $nome[$i], $cognome[$i], $numPartite[$i]) = split(\";\", $squadraB3[$i]);\r\n    }\r\n    $totPartite = 0;\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        $totPartite = $totPartite + $numPartite[$i];\r\n    }\r\n    $valoreSquadraB3 = 0;\r\n    for ($i = 0; $i <= 4; $i++) {\r\n        $valoreSquadraB3 = $valoreSquadraB3 + ($voto[$i] * ($numPartite[$i] / $totPartite));\r\n    }\r\n\r\n    $metodo3 = $valoreSquadraA3 - $valoreSquadraB3;\r\n\r\n    //stampa delle squadre...\r\n    if ($metodo1 < $metodo2) {\r\n        if ($metodo1 < $metodo3) {\r\n            printTeam($squadraA1, $squadraB1);\r\n        } else {\r\n            printTeam($squadraA3, $squadraB3);\r\n        }\r\n    } else {\r\n        if ($metodo2 < $metodo3) {\r\n            printTeam($squadraA2, $squadraB2);\r\n        } else {\r\n            printTeam($squadraA3, $squadraB3);\r\n        }\r\n    }\r\n}\r\n\r\nfunction visualizzaPartiteAccettate($user) {\r\n    $query = \"SELECT p.ID AS ID_PARTITA, DATE_FORMAT(p.ORA_INIZIO,'%H.%i') AS ORA, DATE_FORMAT(p.ORA_INIZIO,'%d-%m-%Y') AS DATA, p.NOTE NOTE, p.ID_ORGANIZZATORE AS ID_ORGANIZZATORE, p.STATO AS STATO, c.NOME AS CAMPO, c.COPERTO AS COPERTO, c.INDIRIZZO AS INDIRIZZO, u.NAME AS NOME, u.SURNAME AS COGNOME FROM PARTITA p, CAMPO c, TZ_MEMBERS u, PARTECIPAZIONE pa WHERE p.ID_ORGANIZZATORE = u.ID and p.ID_CAMPO = c.ID and pa.ID_PARTITA = p.ID and pa.USER_ID = '$user' and pa.PARTECIPA = 1 and p.ORA_INIZIO > now() ORDER BY p.ORA_INIZIO ASC;\";\r\n    $rs = mysql_query($query);\r\n\r\n    $query_org = \"SELECT * FROM PARTITA WHERE ID_ORGANIZZATORE = '$user' AND ORA_INIZIO > now()\";\r\n    $rs_org = mysql_query($query_org);\r\n    $row = mysql_fetch_array($rs);\r\n\r\n    if ($row) {\r\n        echo \"<br />\";\r\n        echo \"<table class='table2'>\";\r\n        echo \"<thead><tr>\";\r\n        echo \"<th scope='col'>Data</th>\";\r\n        echo \"<th scope='col'>Ora</th>\";\r\n        echo \"<th scope='col'>Campo</th>\";\r\n        echo \"<th scope='col'>Coperto</th>\";\r\n        echo \"<th scope='col'>Indirizzo</th>\";\r\n        echo \"<th scope='col'>Organizzatore</th>\";\r\n        echo \"<th scope='col'>Note</th>\";\r\n        echo \"<th scope='col'>Partecipanti</th>\";\r\n        echo \"</tr></thead>\";\r\n\r\n        do {\r\n            $partita = $row[\"ID_PARTITA\"];\r\n            $data = $row[\"DATA\"];\r\n            $ora = $row[\"ORA\"];\r\n            $campo = $row[\"CAMPO\"];\r\n            $coperto = $row[\"COPERTO\"];\r\n            $indirizzo = $row[\"INDIRIZZO\"];\r\n            $organizzatore = $row[\"NOME\"] . \" \" . $row[\"COGNOME\"];\r\n            $note = $row[\"NOTE\"];\r\n            $id_organizzatore = $row['ID_ORGANIZZATORE'];\r\n            $stato = $row['STATO'];\r\n\r\n            echo \"<tbody>\";\r\n            echo \"<tr>\";\r\n            echo \"<td>$data</td>\";\r\n            echo \"<td>$ora</td>\";\r\n            echo \"<td>$campo</td>\";\r\n            if ($coperto == 0) {\r\n                echo \"<td>NO</td>\";\r\n            } else {\r\n                echo \"<td>SI</td>\";\r\n            }\r\n            echo \"<td>$indirizzo</td>\";\r\n            echo \"<td>$organizzatore</td>\";\r\n            echo \"<td width='15%' style='white-space:normal;'>$note</td>\";\r\n            echo \"<td><a class='visualizzaPartecipanti' title='Chi partecipa a questa partita' href='./partite.php?action=partecipanti&id_partita=$partita'>Visualizza</a></center></td>\";\r\n\r\n            echo \"</tr>\";\r\n        } while ($row = mysql_fetch_array($rs));\r\n        echo \"</tbody>\";\r\n        echo \"</table>\";\r\n    } else {\r\n        echo \"<div class='info'>Non sei iscritto a nessuna partita!</div>\";\r\n    }\r\n}\r\n\r\nfunction visualizzaProssimePartite($user) {\r\n\r\n    $query = \"SELECT p.ID AS ID_PARTITA, DATE_FORMAT(p.ORA_INIZIO,'%H.%i') AS ORA, DATE_FORMAT(p.ORA_INIZIO,'%d-%m-%Y') AS DATA, p.NOTE NOTE, p.ID_ORGANIZZATORE AS ID_ORGANIZZATORE, c.NOME AS CAMPO, c.COPERTO AS COPERTO, c.INDIRIZZO AS INDIRIZZO, u.NAME AS NOME, u.SURNAME AS COGNOME FROM PARTITA p, CAMPO c, TZ_MEMBERS u, PARTECIPAZIONE pa WHERE p.ID_ORGANIZZATORE = u.ID and p.ID_CAMPO = c.ID and pa.ID_PARTITA = p.ID and pa.USER_ID = '$user' and pa.PARTECIPA = 0 and p.ORA_INIZIO > now() ORDER BY p.ORA_INIZIO ASC;\";\r\n    $rs = mysql_query($query);\r\n\r\n    if ($row = mysql_fetch_array($rs)) {\r\n        echo \"<br />\";\r\n        echo \"<table class='table2'>\";\r\n        echo \"<thead><tr>\";\r\n        echo \"<th scope='col'>Data</th>\";\r\n        echo \"<th scope='col'>Ora</th>\";\r\n        echo \"<th scope='col'>Campo</th>\";\r\n        echo \"<th scope='col'>Coperto</th>\";\r\n        echo \"<th scope='col'>Indirizzo</th>\";\r\n        echo \"<th scope='col'>Organizzatore</th>\";\r\n        echo \"<th scope='col'>Note</th>\";\r\n        echo \"<th scope='col'>Partecipanti</th>\";\r\n        echo \"<th scope='col'>Partecipa</th>\";\r\n        echo \"</tr></thead>\";\r\n\r\n        do {\r\n            $partita = $row[\"ID_PARTITA\"];\r\n            $data = $row[\"DATA\"];\r\n            $ora = $row[\"ORA\"];\r\n            $campo = $row[\"CAMPO\"];\r\n            $coperto = $row[\"COPERTO\"];\r\n            $indirizzo = $row[\"INDIRIZZO\"];\r\n            $organizzatore = $row[\"NOME\"] . \" \" . $row[\"COGNOME\"];\r\n            $note = $row[\"NOTE\"];\r\n\r\n            echo \"<tbody>\";\r\n            echo \"<tr>\";\r\n            echo \"<td>$data</td>\";\r\n            echo \"<td>$ora</td>\";\r\n            echo \"<td>$campo</td>\";\r\n            if ($coperto == 0) {\r\n                echo \"<td>NO</td>\";\r\n            } else {\r\n                echo \"<td>SI</td>\";\r\n            }\r\n            echo \"<td>$indirizzo</td>\";\r\n            echo \"<td>$organizzatore</td>\";\r\n            echo \"<td width='15%' style='white-space:normal;'>$note</td>\";\r\n            echo \"<td><a class='visualizzaPartecipanti' title='Chi partecipa a questa partita' href='./partite.php?action=partecipanti&id_partita=$partita'>Visualizza</a></td>\";\r\n            echo \"<td>\";\r\n            echo \"<form id='accetta_form_$partita' method='post' action='partite.php' style='float:left;'>\r\n\t \t\t<input type='hidden' name='user_id' value='$user' />\r\n\t \t\t<input type='hidden' name='id_partita' value='$partita' />\r\n\t \t\t<input type='hidden' name='action' value='accetta' />\r\n\t \t\t<img class='accetta_img' src='img/Check_24x24.png' alt='Accetta' title='Accetta la partita' onclick='accettaPartita($partita);'>\r\n\t \t\t</form>\";\r\n            echo \"<form id='rifiuta_form_$partita' method='post' action='partite.php' style='float:right;'>\r\n\t \t\t<input type='hidden' name='user_id' value='$user' />\r\n\t \t\t<input type='hidden' name='id_partita' value='$partita' />\r\n\t \t\t<input type='hidden' name='action' value='rifiuta' />\r\n\t \t\t<img class='rifiuta_img' src='img/Delete_24x24.png' alt='Rifiuta' title='Rifiuta la partita' onclick='rifiutaPartita($partita);'>\r\n\t \t\t</form>\";\r\n            echo \"</td>\";\r\n            echo \"</tr>\";\r\n        } while ($row = mysql_fetch_array($rs));\r\n\r\n        echo \"</tbody>\";\r\n        echo \"</table>\";\r\n    } else {\r\n        echo \"<div class='info'>Non &egrave; presente nessuna partita in programma o non ci sono pi&ugrave; posti disponibili nelle partite alle quali eri stato invitato!</div>\";\r\n    }\r\n}\r\n\r\nfunction visualizzaPartiteAdmin($user) {\r\n\r\n    $query = \"SELECT DISTINCT(p.ID) AS ID_PARTITA, DATE_FORMAT(p.ORA_INIZIO,'%H.%i') AS ORA, DATE_FORMAT(p.ORA_INIZIO,'%d-%m-%Y') AS DATA, p.NOTE NOTE, p.ID_ORGANIZZATORE AS ID_ORGANIZZATORE, p.STATO AS STATO, c.NOME AS CAMPO, c.COPERTO AS COPERTO, c.INDIRIZZO AS INDIRIZZO, u.NAME AS NOME, u.SURNAME AS COGNOME FROM PARTITA p, CAMPO c, TZ_MEMBERS u, PARTECIPAZIONE pa WHERE p.ID_CAMPO = c.ID and p.ID_ORGANIZZATORE = u.ID ORDER BY p.ORA_INIZIO DESC;\";\r\n    $rs = mysql_query($query);\r\n\r\n    if ($row = mysql_fetch_array($rs)) {\r\n        echo \"<br />\";\r\n        echo \"<table class='table2'>\";\r\n        echo \"<thead><tr>\";\r\n        echo \"<th scope='col'>Data</th>\";\r\n        echo \"<th scope='col'>Ora</th>\";\r\n        echo \"<th scope='col'>Campo</th>\";\r\n        echo \"<th scope='col'>Coperto</th>\";\r\n        echo \"<th scope='col'>Indirizzo</th>\";\r\n        echo \"<th scope='col'>Organizzatore</th>\";\r\n        echo \"<th scope='col'>Note</th>\";\r\n        echo \"<th scope='col'>Partecipanti</th>\";\r\n        //echo \"<th scope='col'>Stato</th>\";\r\n        echo \"<th scope='col'>Azioni <img alt='Help' src='img/Help_16x16.png' title=\\\"Puoi annullare una partita che hai organizzato. Chi si era iscritto verr&agrave; avvisato con una e-mail.\\\"></th>\";\r\n        echo \"</tr></thead>\";\r\n\r\n        do {\r\n            $partita = $row[\"ID_PARTITA\"];\r\n            $data = $row[\"DATA\"];\r\n            $ora = $row[\"ORA\"];\r\n            $campo = $row[\"CAMPO\"];\r\n            $coperto = $row[\"COPERTO\"];\r\n            $indirizzo = $row[\"INDIRIZZO\"];\r\n            $organizzatore = $row[\"NOME\"] . \" \" . $row[\"COGNOME\"];\r\n            $note = $row[\"NOTE\"];\r\n            $stato = $row[\"STATO\"];\r\n\r\n            echo \"<tbody>\";\r\n            echo \"<tr>\";\r\n            echo \"<td>$data</td>\";\r\n            echo \"<td>$ora</td>\";\r\n            echo \"<td>$campo</td>\";\r\n            if ($coperto == 0) {\r\n                echo \"<td>NO</td>\";\r\n            } else {\r\n                echo \"<td>SI</td>\";\r\n            }\r\n            echo \"<td>$indirizzo</td>\";\r\n            echo \"<td>$organizzatore</td>\";\r\n            echo \"<td width='15%' style='white-space:normal;'>$note</td>\";\r\n            echo \"<td><a class='visualizzaPartecipanti' title='Chi partecipa a questa partita' href='./partite.php?action=partecipanti&id_partita=$partita'>Visualizza</a></td>\";\r\n            //echo \"<td>$stato</td>\";\r\n\r\n            echo \"<td>\";\r\n            if ($stato != 'C') {\r\n                echo \"<table><tr>\";\r\n                echo \"<td style='padding: 0; margin: 0;'><form id='invita_form_$partita' method='post' action='partite.php'>\r\n                                <input type='hidden' name='id_partita' value='$partita' />\r\n                                <input type='hidden' name='action' value='invita' />\r\n                                <img class='invita_img' src='img/Forward_24x24.png' alt='Invita' title='Invita ulteriori utenti' onclick='invitaUtenti($partita);'>\r\n                                </form></td>\";\r\n//                                echo \"<td style='padding: 0; margin: 0;'><form id='ospiti_form_$partita' method='post' action='partite.php'>\r\n//                                <input type='hidden' name='id_partita' value='$partita' />\r\n//                                <input type='hidden' name='action' value='ospiti' />\r\n//                                <img class='ospiti_img' src='img/User_24x24.png' alt='Aggiungi ospiti' title='Aggiungi ospiti' onclick='aggiungiOspiti($partita);'>\r\n//                                </form></td>\";\r\n                echo \"<td style='padding: 0; margin: 0;'><form id='chiudi_form_$partita' method='post' action='partite.php' >\r\n                                <input type='hidden' name='id_partita' value='$partita' />\r\n                                <input type='hidden' name='action' value='chiudi' />\r\n                                <img class='invita_img' src='img/Check_24x24.png' alt='Chiudi' title='Chiudi e conferma la partita' onclick='chiudiPartita($partita);'>\r\n                                </form></td>\";\r\n                echo \"<td style='padding: 0; margin: 0;'><form id='cancella_form_$partita' method='post' action='partite.php' >\r\n                                <input type='hidden' name='id_partita' value='$partita' />\r\n                                <input type='hidden' name='action' value='cancella' />\r\n                                <img class='cancella_img' src='img/Cancel_24x24.png' alt='Annulla' title='Annulla la partita' onclick='cancellaPartita($partita);'>\r\n                                </form></td>\";\r\n                echo \"</table></tr>\";\r\n            } else {\r\n                echo \"CHIUSA!\";\r\n            }\r\n            echo \"</td>\";\r\n\r\n            echo \"</tr>\";\r\n        } while ($row = mysql_fetch_array($rs));\r\n\r\n        echo \"</tbody>\";\r\n        echo \"</table>\";\r\n    } else {\r\n        echo \"<div class='info'>Non &egrave; presente nessuna partita in programma o non ci sono pi&ugrave; posti disponibili nelle partite alle quali eri stato invitato!</div>\";\r\n    }\r\n}\r\n\r\nfunction visualizzaPartiteEsistenti($user) {\r\n\r\n    $query = \"SELECT p.ID AS ID_PARTITA, DATE_FORMAT(p.ORA_INIZIO,'%H.%i') AS ORA, DATE_FORMAT(p.ORA_INIZIO,'%d-%m-%Y') AS DATA, p.NOTE NOTE,c.NOME AS CAMPO, c.COPERTO AS COPERTO, c.INDIRIZZO AS INDIRIZZO, u.NAME AS NOME, u.SURNAME AS COGNOME FROM PARTITA p, CAMPO c, TZ_MEMBERS u, PARTECIPAZIONE pa WHERE p.ID_ORGANIZZATORE = u.ID and p.ID_CAMPO = c.ID and pa.ID_PARTITA = p.ID and pa.USER_ID = '$user' and p.ORA_INIZIO > now() ORDER BY p.ORA_INIZIO ASC;\";\r\n    $rs = mysql_query($query);\r\n\r\n    if ($row = mysql_fetch_array($rs)) {\r\n        echo \"<br />\";\r\n        echo \"<table class='table2'>\";\r\n        echo \"<thead><tr>\";\r\n        echo \"<th scope='col'>Data</th>\";\r\n        echo \"<th scope='col'>Ora</th>\";\r\n        echo \"<th scope='col'>Campo</th>\";\r\n        echo \"<th scope='col'>Coperto</th>\";\r\n        echo \"<th scope='col'>Organizzatore</th>\";\r\n        echo \"</tr></thead>\";\r\n\r\n        do {\r\n            $partita = $row[\"ID_PARTITA\"];\r\n            $data = $row[\"DATA\"];\r\n            $ora = $row[\"ORA\"];\r\n            $campo = $row[\"CAMPO\"];\r\n            $coperto = $row[\"COPERTO\"];\r\n            $organizzatore = $row[\"NOME\"] . \" \" . $row[\"COGNOME\"];\r\n\r\n            echo \"<tbody>\";\r\n            echo \"<tr>\";\r\n            echo \"<td>$data</td>\";\r\n            echo \"<td>$ora</td>\";\r\n            echo \"<td>$campo</td>\";\r\n            if ($coperto == 0) {\r\n                echo \"<td>NO</td>\";\r\n            } else {\r\n                echo \"<td>SI</td>\";\r\n            }\r\n            echo \"<td>$organizzatore</td>\";\r\n            echo \"</tr>\";\r\n        } while ($row = mysql_fetch_array($rs));\r\n\r\n        echo \"</tbody>\";\r\n        echo \"</table>\";\r\n    } else {\r\n        echo \"<div class='info'>Non &egrave; presente nessuna partita in programma!</div>\";\r\n    }\r\n}\r\n\r\nfunction visualizzaPartitePagelle($user) {\r\n    $query = \"SELECT p.ID AS ID_PARTITA, DATE_FORMAT(p.ORA_INIZIO,'%H.%i') AS ORA, DATE_FORMAT(p.ORA_INIZIO,'%d-%m-%Y') AS DATA, c.NOME AS CAMPO, pa.VOTATO AS VOTATO FROM PARTITA p, CAMPO c, PARTECIPAZIONE pa WHERE p.ID_CAMPO = c.ID and pa.ID_PARTITA = p.ID and pa.USER_ID = '$user' and pa.PARTECIPA = 1 and p.ORA_INIZIO < TIMESTAMPADD(HOUR,-2,CURRENT_TIMESTAMP) ORDER BY p.ORA_INIZIO DESC LIMIT 10;\";\r\n    $rs = mysql_query($query);\r\n\r\n    if ($row = mysql_fetch_array($rs)) {\r\n        echo \"<br />\";\r\n        echo \"<table class='table2'>\";\r\n        echo \"<thead><tr>\";\r\n        echo \"<th scope='col'>Data</th>\";\r\n        echo \"<th scope='col'>Ora</th>\";\r\n        echo \"<th scope='col'>Campo</th>\";\r\n        echo \"<th scope='col'>Voti <img alt='Help Annulla' src='img/Help_16x16.png' title=\\\"Puoi votare una partita o visualizzare i voti\\\"></th>\";\r\n\r\n        echo \"</tr></thead>\";\r\n\r\n        do {\r\n            $partita = $row[\"ID_PARTITA\"];\r\n            $hasVotato = $row[\"VOTATO\"];\r\n            $data = $row[\"DATA\"];\r\n            $ora = $row[\"ORA\"];\r\n            $campo = $row[\"CAMPO\"];\r\n\r\n            echo \"<tbody>\";\r\n            echo \"<tr>\";\r\n            echo \"<td>$data</td>\";\r\n            echo \"<td>$ora</td>\";\r\n            echo \"<td>$campo</td>\";\r\n            echo \"<td>\";\r\n            if ($hasVotato == 0) {\r\n                echo \"<form id='vota_partita_$partita' method='post' action='partite.php'>\r\n\t\t \t\t<input type='hidden' name='id_partita' value='$partita' />\r\n\t\t \t\t<input type='hidden' name='dataPartita' value='$data' />\r\n\t\t \t\t<input type='hidden' name='action' value='vota' />\r\n\t \t\t\t<img class='cancella_img' src='img/Favorites_24x24.png' alt='Vota' title='Vota i partecipanti' onclick='votaPartita($partita);'>\r\n\t \t\t\t</form>\";\r\n            } elseif ($hasVotato == 1) {\r\n                echo \"<form id='visualizza_voti_$partita' method='post' action='partite.php'>\r\n\t \t\t\t<input type='hidden' name='id_partita' value='$partita' />\r\n\t \t\t\t<input type='hidden' name='dataPartita' value='$data' />\r\n\t \t\t\t<input type='hidden' name='action' value='visualizzaVoti' />\r\n\t \t\t\t<img class='cancella_img' src='img/Preview_24x24.png' alt='Visualizza' title='Visualizza i voti' onclick='visualizzaVoti($partita);'>\r\n\t \t\t\t</form>\";\r\n            }\r\n\r\n            echo \"</td>\";\r\n            echo \"</tr>\";\r\n        } while ($row = mysql_fetch_array($rs));\r\n        echo \"</tbody>\";\r\n        echo \"</table>\";\r\n    } else {\r\n        echo \"<div class='info'>Non ci sono partite a cui hai partecipato!</div>\";\r\n    }\r\n}\r\n\r\nfunction nuovaPartita($user, $ora_inizio, $campo, $note, $invitaTutti, $numGiocatori) {\r\n\r\n    $query1 = '';\r\n    $query1 = \"INSERT INTO PARTITA (ID_CAMPO, ORA_INIZIO, ID_ORGANIZZATORE, NOTE, NUM_GIOCATORI) VALUES ($campo, '$ora_inizio','$user','$note', '$numGiocatori')\";\r\n    if (mysql_query($query1)) {\r\n        echo \"<div class='success'>La partita &egrave; stata creata!\";\r\n\r\n        $query2 = '';\r\n        $query2 = \"SELECT MAX(ID) AS MASSIMO FROM PARTITA\";\r\n        $rs2 = mysql_query($query2);\r\n        if ($row2 = mysql_fetch_array($rs2)) {\r\n            $idPartita = $row2[\"MASSIMO\"];\r\n        }\r\n        $query3 = '';\r\n        $query3 = \"INSERT INTO PARTECIPAZIONE (USER_ID, ID_PARTITA, PARTECIPA) VALUES ('$user', $idPartita, 1)\";\r\n        /* echo \"</br><p>Torna alla <a href='nuovaPartita.php'>pagina principale</a>.</p>\"; */\r\n        if (mysql_query($query3))\r\n            ;\r\n        if ($invitaTutti == '1') {\r\n            invitaTutti($user, $idPartita, true);\r\n        }\r\n    } else {\r\n        echo \"<div class='error'>Si &egrave, verificato un errore. La partita non &egrave; stata creata.</div>\";\r\n        echo \"</br><p>Torna alla <a href='visualizzaPartite.php'>pagina precedente</a>.</p>\";\r\n    }\r\n}\r\n\r\nfunction invitaTutti($idUser, $idPartita, $isStrict) {\r\n\r\n    global $logger;\r\n    $row1 = getUserById($idUser);\r\n    $nomeOrg = $row1[\"NAME\"] . \" \" . $row1[\"SURNAME\"];\r\n    $emailOrg = $row1[\"EMAIL\"];\r\n\r\n    $rsPartita = getPartitaById($idPartita);\r\n    $rowPartita = mysql_fetch_array($rsPartita);\r\n    $data = $rowPartita[\"DATA\"];\r\n    $ora = $rowPartita[\"ORA\"];\r\n    $note = $rowPartita[\"NOTE\"];\r\n    $idCampo = $rowPartita[\"ID_CAMPO\"];\r\n\r\n    $rsCampo = getCampoById($idCampo);\r\n    $rowCampo = mysql_fetch_array($rsCampo);\r\n    $nomeCampo = $rowCampo[\"NOME\"];\r\n    $indCampo = $rowCampo[\"INDIRIZZO\"];\r\n\r\n    if ($isStrict) {\r\n        $query = \"SELECT ID, NAME, SURNAME, EMAIL, ACCEPT FROM TZ_MEMBERS WHERE ID <> '$idUser' AND ID NOT LIKE 'guest%' AND (LEVEL = 1 OR LEVEL = 9) ORDER BY NAME;\";\r\n    } else {\r\n        $query = \"SELECT ID, NAME, SURNAME, EMAIL, ACCEPT FROM TZ_MEMBERS WHERE ID <> '$idUser' AND ID NOT LIKE 'guest%' AND LEVEL < 1 ORDER BY NAME;\";\r\n    }\r\n\r\n    $rsUtenti = mysql_query($query);\r\n    $c = 0;\r\n    $p = mysql_num_rows($rsUtenti);\r\n    while ($row = mysql_fetch_array($rsUtenti)) {\r\n\r\n        $email = $row[\"EMAIL\"];\r\n        $idPartecipante = $row[\"ID\"];\r\n        $nome = $row[\"NAME\"];\r\n        $accept = $row[\"ACCEPT\"];\r\n        if ($accept == 1) {\r\n            $message = '\r\n\t\t\t\t<html>\r\n\t\t\t\t<head>\r\n\t\t\t\t  <title>Nuova Partita</title>\r\n\t\t\t\t</head>\r\n\t\t\t\t<body style=\"font-family: verdana, sans-serif; color: #272727;\">\r\n\t\t\t\t  <p>Ciao ' . $nome . ',<br />' . $nomeOrg . ' sta organizzando una <strong>nuova partita</strong>.</p>\r\n\t\t\t\t  <p>In base alle tue preferenze, <strong>sei stato iscritto in automatico</strong>.</p>\r\n\t\t\t\t  <p>\r\n\t\t\t\t  Data: <strong>' . $data . '</strong><br />\r\n\t\t\t\t  Ora: <strong>' . $ora . '</strong><br />\r\n\t\t\t\t  Dove: ' . $nomeCampo . ' - ' . $indCampo . '<br />\r\n\t\t\t\t  Note: ' . $note . '\r\n\t\t\t\t  </p>\r\n\t\t\t\t  <p>Vai sul sito (<a href=\"http://mycalcetto.altervista.org\" target=\"_blank\">mycalcetto.altervista.org</a>) per modificare i tuoi dati.</p>\r\n\t\t\t\t  <p>Saluti,<br/>il team di MyCalcetto</p>\r\n\t\t\t\t</body>\r\n\t\t\t\t</html>';\r\n        } else {\r\n            $message = '\r\n\t\t\t\t<html>\r\n\t\t\t\t<head>\r\n\t\t\t\t  <title>Nuova Partita</title>\r\n\t\t\t\t</head>\r\n\t\t\t\t<body style=\"font-family: verdana, sans-serif; color: #272727;\">\r\n\t\t\t\t  <p>Ciao ' . $nome . ',<br />' . $nomeOrg . ' sta organizzando una <strong>nuova partita</strong>.</p>\r\n\t\t\t\t  <p>Vieni a giocare? <strong>Iscriviti</strong> sul sito (<a href=\"http://mycalcetto.altervista.org\" target=\"_blank\">mycalcetto.altervista.org</a>).</p>\r\n\t\t\t\t  <p>\r\n\t\t\t\t  Data: <strong>' . $data . '</strong><br />\r\n\t\t\t\t  Ora: <strong>' . $ora . '</strong><br />\r\n\t\t\t\t  Dove: ' . $nomeCampo . ' - ' . $indCampo . '<br />\r\n\t\t\t\t  Note: ' . $note . '\r\n\t\t\t\t  </p>\r\n\t\t\t\t  <p>Saluti,<br/>il team di MyCalcetto</p>\r\n\t\t\t\t</body>\r\n\t\t\t\t</html>';\r\n        }\r\n        if (send_mail('MyCalcetto <mycalcetto@altervista.org>', $email, 'Nuova Partita', $message, $emailOrg)) {\r\n            $query0 = \"\";\r\n            $rs0 = null;\r\n            if ($accept == 1) {\r\n                $query0 = \"INSERT INTO PARTECIPAZIONE (USER_ID, ID_PARTITA, PARTECIPA) VALUES ('$idPartecipante', $idPartita, 1)\";\r\n            } else {\r\n                $query0 = \"INSERT INTO PARTECIPAZIONE (USER_ID, ID_PARTITA, PARTECIPA) VALUES ('$idPartecipante', $idPartita, 0)\";\r\n            }\r\n            $rs0 = mysql_query($query0);\r\n            $c = $c + 1;\r\n            $logger->logThis($logger->get_formatted_date() . '[INFO] Invito inviato a: ' . $email);\r\n            sleep(1);\r\n        } else {\r\n            $logger->logThis($logger->get_formatted_date() . '[ERROR] Impossibile inviare invito a: ' . $email);\r\n        }\r\n    }\r\n\r\n    echo \"<br />Sono state invitate $c persone, su $p</div>\";\r\n    echo \"</br><p>Torna alla <a href='visualizzaPartite.php'>pagina principale</a>.</p>\";\r\n}\r\n\r\nfunction getPartitaById($idPartita) {\r\n\r\n    $res = mysql_query(\"SELECT ID, ID_CAMPO, DATE_FORMAT(ORA_INIZIO,'%H.%i') AS ORA, DATE_FORMAT(ORA_INIZIO,'%d-%m-%Y') AS DATA, ID_ORGANIZZATORE, NOTE from PARTITA where ID='\" . $idPartita . \"'\") or die(mysql_error());\r\n    return $res;\r\n}\r\n\r\nfunction visualizzaPagelle($idPartita) {\r\n    $query = \"SELECT u.ID AS USER_ID, u.NAME as NOME, u.SURNAME AS COGNOME, p.SOMMAVOTI AS SOMMAVOTI, p.NUMVOTANTI AS NUMVOTANTI FROM PARTECIPAZIONE p, TZ_MEMBERS u WHERE p.ID_PARTITA = $idPartita AND u.ID = p.USER_ID AND p.PARTECIPA = 1 AND u.ID NOT LIKE 'guest%' ORDER BY NOME ASC;\";\r\n    $rs = mysql_query($query);\r\n\r\n    if ($row = mysql_fetch_array($rs)) {\r\n        echo \"<br />\";\r\n        echo \"<table class='table2'>\";\r\n        echo \"<thead><tr>\";\r\n        echo \"<th scope='col'>Nome</th>\";\r\n        echo \"<th scope='col'>Media Voti</th>\";\r\n        echo \"</tr></thead>\";\r\n\r\n        do {\r\n            $partecipante = $row[\"NOME\"] . \" \" . $row[\"COGNOME\"];\r\n            $idPartecipante = $row[\"USER_ID\"];\r\n            $sommavoti = $row[\"SOMMAVOTI\"];\r\n            $numvotanti = $row[\"NUMVOTANTI\"];\r\n            if ($sommavoti == 0 | $numvotanti == 0) {\r\n                $media = \"s.v.\";\r\n            } else {\r\n                $media = $sommavoti / $numvotanti;\r\n                $media = number_format($media, 2, '.', ',');\r\n            }\r\n            $style = '';\r\n            if ($media == \"s.v.\") {\r\n                $style = '';\r\n            } else if ($media >= 6) {\r\n                $style = ' style=\"color: #00FF00;\"';\r\n            } else {\r\n                $style = ' style=\"color: #FF0000;\"';\r\n            }\r\n\r\n            echo \"<tbody>\";\r\n            echo \"<tr>\";\r\n            echo \"<td style='text-align: left;'>$partecipante</td>\";\r\n            echo \"<td$style>$media</td>\";\r\n            echo \"</tr>\";\r\n        } while ($row = mysql_fetch_array($rs));\r\n        echo \"</tbody>\";\r\n        echo \"</table>\";\r\n    } else {\r\n        echo \"<div class='info'>Non sono presenti voti!</div>\";\r\n    }\r\n}\r\n\r\nfunction aggiungiVoto($voto, $idPartita, $idPartecipante) {\r\n    $query0 = \"UPDATE PARTECIPAZIONE SET SOMMAVOTI = SOMMAVOTI + $voto, NUMVOTANTI = NUMVOTANTI+1 WHERE ID_PARTITA = $idPartita AND USER_ID = '$idPartecipante';\";\r\n    $result0 = mysql_query($query0);\r\n}\r\n\r\nfunction aggiornaVotazione($userId, $idPartita) {\r\n    $query1 = \"UPDATE PARTECIPAZIONE SET VOTATO = 1 WHERE USER_ID = '$userId' AND ID_PARTITA = $idPartita\";\r\n    return mysql_query($query1);\r\n}\r\n\r\nfunction countPartiteGiocate($userId) {\r\n    $query0 = \"SELECT PA.ID_PARTITA FROM PARTECIPAZIONE PA, PARTITA P WHERE PA.ID_PARTITA=P.ID AND P.ORA_INIZIO<TIMESTAMPADD(HOUR,-2,CURRENT_TIMESTAMP) AND PA.PARTECIPA=1 AND PA.USER_ID = '$userId' ;\";\r\n    $result0 = mysql_query($query0);\r\n    return mysql_num_rows($result0);\r\n}\r\n\r\nfunction countPartiteProssime($userId) {\r\n    $query0 = \"SELECT PA.ID_PARTITA FROM PARTECIPAZIONE PA, PARTITA P WHERE PA.ID_PARTITA=P.ID AND P.ORA_INIZIO>CURRENT_TIMESTAMP AND PA.PARTECIPA=1 AND PA.USER_ID = '$userId' ;\";\r\n    $result0 = mysql_query($query0);\r\n    return mysql_num_rows($result0);\r\n}\r\n\r\nfunction getTotaleVoti($userId) {\r\n    $query0 = \"SELECT SUM(SOMMAVOTI) AS TOTALEVOTI FROM PARTECIPAZIONE WHERE PARTECIPA=1 AND SOMMAVOTI <> 0 AND USER_ID='$userId' ;\";\r\n    $result0 = mysql_query($query0);\r\n    $row = mysql_fetch_array($result0);\r\n    $totaleVoti = $row['TOTALEVOTI'];\r\n    return $totaleVoti;\r\n}\r\n\r\nfunction countPartiteConVoti($userId) {\r\n    $query0 = \"SELECT PA.ID_PARTITA FROM PARTECIPAZIONE PA WHERE PARTECIPA=1 AND SOMMAVOTI<>0 AND PA.USER_ID = '$userId' ;\";\r\n    $result0 = mysql_query($query0);\r\n    return mysql_num_rows($result0);\r\n}\r\n\r\nfunction getVotiArray($userId) {\r\n    $query0 = \"SELECT SOMMAVOTI/NUMVOTANTI AS VOTO FROM PARTECIPAZIONE WHERE PARTECIPA=1 AND SOMMAVOTI <> 0 AND USER_ID='$userId';\";\r\n    $result0 = mysql_query($query0);\r\n    $arrayVoti = '';\r\n    while ($row = mysql_fetch_array($result0)) {\r\n        $arrayVoti = $arrayVoti . \"\" . $row['VOTO'] . \",\";\r\n    }\r\n    return substr($arrayVoti, 0, -1);\r\n}\r\n\r\nfunction getMediaVotiTotale($userId) {\r\n    $query = \"SELECT SUM(SOMMAVOTI)/SUM(NUMVOTANTI) AS MEDIA FROM PARTECIPAZIONE WHERE USER_ID = '$userId' AND PARTECIPA = 1 GROUP BY USER_ID\";\r\n    $result = mysql_query($query);\r\n    $row1 = mysql_fetch_array($result);\r\n    return $row1[\"MEDIA\"];\r\n}\r\n\r\nfunction visualizzaMediaVotiUsers() {\r\n    $query = \"SELECT ID AS ID_USER, NAME AS NOME, SURNAME AS COGNOME, SUM(SOMMAVOTI)/SUM(NUMVOTANTI) AS MEDIA, COUNT(ID_PARTITA) AS NUM_PARTITE FROM PARTECIPAZIONE, TZ_MEMBERS WHERE ID=USER_ID AND PARTECIPA = 1 AND SOMMAVOTI<>0 AND NAME<>'Ospite' GROUP BY ID ORDER BY NUM_PARTITE DESC;\";\r\n    $rs = mysql_query($query);\r\n\r\n    if ($row = mysql_fetch_array($rs)) {\r\n        echo \"<br />\";\r\n        echo \"<table class='table2'>\";\r\n        echo \"<thead><tr>\";\r\n        echo \"<th scope='col'></th>\";\r\n        echo \"<th scope='col'>Nome</th>\";\r\n        echo \"<th scope='col'>Media voti</th>\";\r\n        echo \"<th scope='col'>Partite giocate</th>\";\r\n        echo \"</tr></thead>\";\r\n\r\n        do {\r\n            $userId = $row[\"ID_USER\"];\r\n            $partecipante = $row[\"NOME\"] . \" \" . $row[\"COGNOME\"];\r\n            $voto = $row[\"MEDIA\"];\r\n            $numPartite = $row[\"NUM_PARTITE\"];\r\n            $voto = round($voto, 2);\r\n            $style = '';\r\n            if ($voto == \"s.v.\") {\r\n                $style = '';\r\n            } else if ($voto >= 6) {\r\n                $style = ' style=\"color: #00FF00;\"';\r\n            } else {\r\n                $style = ' style=\"color: #FF0000;\"';\r\n            }\r\n\r\n            echo \"<tbody>\";\r\n            echo \"<tr>\";\r\n            echo \"<td style='text-align: left;'><input type='checkbox' value='$userId' /></td>\";\r\n            echo \"<td style='text-align: left;'><a class='statistiche' href='./partite.php?action=statistiche&id_user=$userId'>$partecipante</a></td>\";\r\n            echo \"<td$style>$voto</td>\";\r\n            echo \"<td>$numPartite</td>\";\r\n            echo \"</tr>\";\r\n        } while ($row = mysql_fetch_array($rs));\r\n        echo \"</tbody>\";\r\n        echo \"</table>\";\r\n        echo \"<p><a onclick='confronta();' class='awesome medium blue' id='formButton'>Confronta</a></p>\";\r\n    } else {\r\n        echo \"<div class='info'>Non sono presenti voti!</div>\";\r\n    }\r\n}\r\n\r\nfunction visualizzaStatistiche($userId) {\r\n    $numPartite = countPartiteGiocate($userId);\r\n    $numPartiteProssime = countPartiteProssime($userId);\r\n    $numVoti = countPartiteConVoti($userId);\r\n    $mediaVoti = round(getMediaVotiTotale($userId), 2);\r\n\r\n    if ($numVoti > 0) {\r\n        $totaleVoti = getTotaleVoti($userId);\r\n        $arrayVoti = getVotiArray($userId);\r\n    } else {\r\n        $mediaVoti = 'n.d.';\r\n    }\r\n    echo\"\r\n    <table class='table2'>\r\n    <tbody>\r\n    <tr>\r\n        <th scope='row'>Partite Giocate</th>\r\n        <td>$numPartite</td>\r\n    </tr>\r\n    <tr>\r\n        <th scope='row'>Media voti</th>\r\n        <td>$mediaVoti</td>\r\n    </tr>\r\n    </tbody>\r\n    </table>\r\n    <p></p>\";\r\n    if (!empty($arrayVoti)) {\r\n        echo'<div><img src=\"http://chart.apis.google.com/chart?chf=c,lg,0,EFEFEF,0,BBBBBB,1&chxr=0,0,10&chxs=0,676767,11.5,0,lt,676767&chxt=y&chs=500x225&cht=lc&chco=3D7930&chds=0,10&chd=t:' . $arrayVoti . '&chg=10,-1,1,1&chls=2,4,0&chm=B,C5D4B5BB,0,0,0&chtt=Andamento+voti&chm=B,C5D4B5BB,0,0,0|s,FF0000,0,-1,5\" width=\"300\" height=\"225\" alt=\"Andamento voti\" /></div>';\r\n    }\r\n}\r\n\r\nfunction visualizzaConfronto($userId1, $userId2) {\r\n    $arrayVoti1 = getVotiArray($userId1);\r\n    $arrayVoti2 = getVotiArray($userId2);\r\n    $user1 = getUserById($userId1);\r\n    $user2 = getUserById($userId2);\r\n    $nome1 = $user1[\"NAME\"] . \" \" . $user1[\"SURNAME\"];\r\n    $nome2 = $user2[\"NAME\"] . \" \" . $user2[\"SURNAME\"];\r\n\r\n    echo'<div><img src=\"http://chart.apis.google.com/chart?chf=c,lg,0,EFEFEF,0,BBBBBB,1&chxr=0,0,10&chxs=0,676767,11.5,0,lt,676767&chxt=y&chs=500x375&cht=lc&chco=3D7930,FF9900&chds=0,10&chd=t:' . $arrayVoti1 . '|' . $arrayVoti2 . '&chdl=' . $nome1 . '|' . $nome2 . '&chg=10,-1,1,1&chls=2,4,0&chtt=Andamento+voti&chdlp=b\" width=\"500\" height=\"375\" alt=\"Andamento voti\" /></div>';\r\n}\r\n\r\n?>\r\n"]],"start1":0,"start2":0,"length1":0,"length2":49546}]],"length":49546}
{"contributors":[],"silentsave":false,"ts":1343809687262,"patch":[[{"diffs":[[0,"ITA WHERE ID"],[-1,"_PARTITA"],[0," = $id_parti"]],"start1":774,"start2":774,"length1":32,"length2":24},{"diffs":[[0,");\r\n"],[-1,"    \r\n"],[0,"    "]],"start1":929,"start2":929,"length1":14,"length2":8}]],"length":49532,"saved":false}
{"contributors":[],"silentsave":true,"ts":1360600934207,"patch":[[{"diffs":[[0,"OCATORI "],[1,"AS NUMERO "],[0,"FROM PAR"]],"start1":757,"start2":757,"length1":16,"length2":26},{"diffs":[[0,"l_query("],[1,"$"],[0,"numero_g"]],"start1":843,"start2":843,"length1":16,"length2":17},{"diffs":[[0,"'NUM"],[-1,"_GIOCATORI"],[1,"ERO"],[0,"'];\r\n"],[1,"    "],[0,"\r\n  "]],"start1":988,"start2":988,"length1":23,"length2":20},{"diffs":[[0,"onibili!"],[1," Max: $numero_giocatori."],[0,"</div>\";"]],"start1":3026,"start2":3026,"length1":16,"length2":40},{"diffs":[[0,"}\r\n    }\r\n\r\n"],[1,"PDATE  `my_mycalcetto`.`PARTITA` SET  `ORA_INIZIO` = NOW( ) ,\r\n`STATO` =  'A' WHERE  `PARTITA`.`ID` =180 LIMIT 1 ;\r\n\r\n"],[0,"    $query ="]],"start1":8091,"start2":8091,"length1":24,"length2":142}]],"length":49682,"saved":false}
{"ts":1360600939229,"patch":[[{"diffs":[[0,"NOW( ) ,"],[-1,"\r\n"],[0,"`STATO` "]],"start1":8156,"start2":8156,"length1":18,"length2":16}]],"length":49680,"saved":false}
{"ts":1360600943192,"patch":[[{"diffs":[[0,"   }\r\n\r\n"],[1,"U"],[0,"PDATE  `"]],"start1":8095,"start2":8095,"length1":16,"length2":17}]],"length":49681,"saved":false}
{"ts":1360600949747,"patch":[[{"diffs":[[0,"TE  "],[-1,"`my_mycalcetto`.`"],[0,"PART"]],"start1":8107,"start2":8107,"length1":25,"length2":8}]],"length":49664,"saved":false}
{"ts":1360600951719,"patch":[[{"diffs":[[0," PARTITA"],[-1,"`"],[0," SET  `O"]],"start1":8110,"start2":8110,"length1":17,"length2":16}]],"length":49663,"saved":false}
{"ts":1360600954447,"patch":[[{"diffs":[[0,"TA SET  "],[-1,"`"],[0,"ORA_INIZ"]],"start1":8116,"start2":8116,"length1":17,"length2":16},{"diffs":[[0,"A_INIZIO"],[-1,"`"],[0," = NOW( "]],"start1":8126,"start2":8126,"length1":17,"length2":16}]],"length":49661,"saved":false}
{"ts":1360600960125,"patch":[[{"diffs":[[0,"ET  "],[-1,"ORA_INIZIO = NOW( ) ,`"],[0,"STATO"],[-1,"`"],[0," =  "]],"start1":8120,"start2":8120,"length1":36,"length2":13}]],"length":49638,"saved":false}
{"ts":1360600966233,"patch":[[{"diffs":[[0,"ERE "],[-1," `PARTITA`.`"],[0,"ID` "]],"start1":8139,"start2":8139,"length1":20,"length2":8}]],"length":49626,"saved":false}
{"ts":1360600969058,"patch":[[{"diffs":[[0,"WHERE ID"],[1,"PDATE  `my_mycalcetto`.`PARTITA` SET  `ORA_INIZIO` = NOW( ) ,\r\n`STATO` =  'A' WHERE  `PARTITA`.`ID` =180 LIMIT 1 ;"],[0,"` =180 L"]],"start1":8137,"start2":8137,"length1":16,"length2":130}]],"length":49740,"saved":false}
{"ts":1360600972589,"patch":[[{"diffs":[[0,"E ID"],[-1,"PDATE  `my_mycalcetto`.`PARTITA` SET  `ORA_INIZIO` = NOW( ) ,\r\n`STATO` =  'A' WHERE  `PARTITA`.`ID` =180 LIMIT 1 ;"],[0,"` =1"]],"start1":8141,"start2":8141,"length1":122,"length2":8}]],"length":49626,"saved":false}
{"ts":1360600982256,"patch":[[{"diffs":[[0,"E ID"],[-1,"` =180 LIMIT 1"],[0," ;\r\n"]],"start1":8141,"start2":8141,"length1":22,"length2":8}]],"length":49612,"saved":false}
{"ts":1360600992895,"patch":[[{"diffs":[[0,"\nUPDATE "],[-1," "],[0,"PARTITA "]],"start1":8102,"start2":8102,"length1":17,"length2":16}]],"length":49611,"saved":false}
{"ts":1360601000027,"patch":[[{"diffs":[[0,"\r\n\r\n"],[-1,"UPDATE PARTITA SET  STATO =  'A' WHERE ID ;\r\n"],[0,"\r\n  "]],"start1":8099,"start2":8099,"length1":53,"length2":8}]],"length":49566,"saved":false}
{"ts":1360601001781,"patch":[[{"diffs":[[0,"}\r\n    }\r\n\r\n"],[-1,"\r\n"],[0,"    $query ="]],"start1":8091,"start2":8091,"length1":26,"length2":24}]],"length":49564,"saved":false}
{"ts":1360601009568,"patch":[[{"diffs":[[0,"}\r\n    }\r\n\r\n    "],[1,"//"],[0,"$query = \"DELETE"]],"start1":8091,"start2":8091,"length1":32,"length2":34}]],"length":49566,"saved":false}
{"ts":1360601012929,"patch":[[{"diffs":[[0," $id_partita\";\r\n"],[1,"    UPDATE PARTITA SET  STATO =  'A' WHERE ID\r\n"],[0,"    $result = my"]],"start1":8149,"start2":8149,"length1":32,"length2":79}]],"length":49613,"saved":false}
{"ts":1360601019353,"patch":[[{"diffs":[[0,"\";\r\n    "],[1,"$query = \""],[0,"UPDATE P"]],"start1":8161,"start2":8161,"length1":16,"length2":26}]],"length":49623,"saved":false}
{"ts":1360601026397,"patch":[[{"diffs":[[0,"WHERE ID"],[1," = $id_partita\";"],[0,"\r\n    $r"]],"start1":8212,"start2":8212,"length1":16,"length2":32}]],"length":49639,"saved":false}
{"ts":1360601036805,"patch":[[{"diffs":[[0,"ry);\r\n\r\n    "],[1,"//"],[0,"$query2 = \"D"]],"start1":8268,"start2":8268,"length1":24,"length2":26}]],"length":49641,"saved":false}
{"ts":1360601038898,"patch":[[{"diffs":[[0,"_partita\";\r\n    "],[1,"//"],[0,"$result2 = mysql"]],"start1":8342,"start2":8342,"length1":32,"length2":34}]],"length":49643,"saved":false}
{"ts":1360601047847,"patch":[[{"diffs":[[0,"ITA SET "],[-1," "],[0,"STATO = "]],"start1":8190,"start2":8190,"length1":17,"length2":16}]],"length":49642,"saved":false}
{"ts":1360601051799,"patch":[[{"diffs":[[0," STATO ="],[-1," "],[0," 'A' WHE"]],"start1":8197,"start2":8197,"length1":17,"length2":16}]],"length":49641,"saved":false}
{"ts":1360601735708,"patch":[[{"diffs":[[0,"          } else"],[1,"if ($stato != 'C') "],[0," {\r\n            "]],"start1":31608,"start2":31608,"length1":32,"length2":51}]],"length":49660,"saved":false}
{"ts":1360601739619,"patch":[[{"diffs":[[0,"eif ($stato "],[-1,"!"],[1,"="],[0,"= 'C')  {\r\n "]],"start1":31623,"start2":31623,"length1":25,"length2":25}]],"length":49660,"saved":false}
{"ts":1360601746260,"patch":[[{"diffs":[[0,"\"CHIUSA!\";\r\n"],[1,"            } elseif ($stato == 'C')  {\r\n                echo \"CHIUSA!\";\r\n"],[0,"            "]],"start1":31668,"start2":31668,"length1":24,"length2":98}]],"length":49734,"saved":false}
{"ts":1360601749473,"patch":[[{"diffs":[[0,"eif ($stato == '"],[-1,"C"],[1,"A"],[0,"')  {\r\n         "]],"start1":31697,"start2":31697,"length1":33,"length2":33}]],"length":49734,"saved":false}
{"ts":1360601751175,"patch":[[{"diffs":[[0,"          echo \""],[-1,"CHIUS"],[1,"ANNULL"],[0,"A!\";\r\n          "]],"start1":31727,"start2":31727,"length1":37,"length2":38}]],"length":49735,"saved":false}
{"ts":1360601752891,"patch":[[{"diffs":[[0,"\"ANNULLA"],[1,"TA"],[0,"!\";\r\n   "]],"start1":31742,"start2":31742,"length1":16,"length2":18}]],"length":49737,"saved":false}
{"ts":1360601755270,"patch":[[{"diffs":[[0,";\r\n            }"],[1," else"],[0,"\r\n            ec"]],"start1":31754,"start2":31754,"length1":32,"length2":37}]],"length":49742,"saved":false}
{"ts":1360601757297,"patch":[[{"diffs":[[0,"  } else"],[1," {}"],[0,"\r\n      "]],"start1":31767,"start2":31767,"length1":16,"length2":19}]],"length":49745,"saved":false}
{"ts":1360601758578,"patch":[[{"diffs":[[0,"} else {"],[1,"\r\n                \r\n            "],[0,"}\r\n     "]],"start1":31769,"start2":31769,"length1":16,"length2":48}]],"length":49777,"saved":false}
{"ts":1360601825715,"patch":[[{"diffs":[[0,"            "],[1,"echo \"\";"],[0,"\r\n          "]],"start1":31783,"start2":31783,"length1":24,"length2":32}]],"length":49785,"saved":false}
